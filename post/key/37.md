<!--
@key 37
@title Explosion 开发笔记 (二)
@date 2021-5-3
@labels Explosion
@description 我和 Explosion 游戏引擎那些事
-->

# 不省心的 RHI
RHI 是写引擎绕不开的巨坑，时常想吐槽这么多 API，你们相互之间打一架好不好，这么多年了也一直搞不出一个统一的 API，各个平台都想围绕自己打造封闭的生态。

写 RHI 最难的事情就是要拿一套统一的接口去封装多个图形 API，于是乎割舍功能和删删改改变成了常态，称 RHI 为脏活累活一点不过分。对各个 API 的了解程度将直接决定 RHI 最终接口的实用程度。

别的很多东西其实可以借鉴老哥们，但是针对 RHI 这层来说，老大哥们的封装其实也不咋地，因为以前的 API 粒度毕竟是较 High Level 的（如 OpenGL、DX9 一类的），很多情况下无法发挥完全能效，再或者看看 CryEngine，索性直接 typedef 实现多态，硬生生把 RHI 和 RPI 糊在一起，只要我没有 RHI，最不存在烦恼，嗯，没毛病。

之前也听同事吐槽过，自己造引擎如果从底层开始写，写到最后发现自己删了好几遍代码，写来写去最后还是一个三角形，上面的啥也没写。

我目前的想法是先按照 Vulkan 的概念简单封装后搭建 Driver 的公共接口，然后速度地把 VulkanDriver 先做出来，之后上面的 RPI 和游戏逻辑框架也可以先写起来了，日后再慢慢补充 DX12Driver 和 MetalDriver。

目前 VulkanDriver 封装的概念如下：

* Driver
* Device
* SwapChain
* Image
* ImageView
* Texture
* RenderPass
* FrameBuffer
* Pipeline
* GpuBuffer
* CommandBuffer
* CommandEncoder
* Signal
* Fence

基本涵盖了 Vulkan 的大部分概念，实现的过程中发现主要是 Enum 的转换与 Flags 的处理比较恶心，我目前的想法是尽量使用继承和多态将复杂的 Flags 组合给完全屏蔽掉，这样也有利于其他 Driver 的扩展。

目前 VulkanDriver 已经基本实现完全了，等着开始测试绘制功能，然后就可以开始写 RPI 了，RHI 在日后逐步修改与添加功能，争取不在上面放太多精力，等到 DX12 和 Metal 也添加进来后，再慢慢开始写 RHI 线程管理、内存管理、 CommandQueue 一类的高级功能。

# ECS, 曙光还是末日?

介绍 ECS 前，我们先简单回顾下传统的 GameObject 游戏编程范式，在 GameObject 的世界里，游戏对象被称为 GameObject，而 Component 被称为组件，组件是**承载数据和逻辑**的单位
