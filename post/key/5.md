<!--
@key 5
@title ä½¿ç”¨åŸç”Ÿ JavaScript å°è£… Ajax æ“ä½œ
@date 2018-4-24
@labels JavaScript Ajax Http
-->

# ğŸ“¦ å°è£…ä¸¾ä¾‹

```javascript
export class Ajax {
    static get(url, data, hook) {
        let xmlHttpRequest = new XMLHttpRequest();

        url += '?';
        let count = -1;
        for (let key in data) {
            count++;
            if (data.hasOwnProperty(key)) {
                url += count === 0 ? key + '=' + data[key] : '&' + key + '=' + data[key];
            }
        }

        xmlHttpRequest.open('GET', url, true);
        xmlHttpRequest.onreadystatechange = () => {
            if (xmlHttpRequest.readyState === 4 &&
                xmlHttpRequest.status === 200 ||
                xmlHttpRequest.status === 304) {
                hook(xmlHttpRequest.responseText)
            }
        };
        xmlHttpRequest.send();
    }

    static post(url, data, hook) {
        let xmlHttpRequest = new XMLHttpRequest();

        let formatData = '';
        let count = -1;
        for (let key in data) {
            count++;
            if (data.hasOwnProperty(key)) {
                formatData += count === 0 ? key + '=' + data[key] : '&' + key + '=' + data[key];
            }
        }

        xmlHttpRequest.open('POST', url, true);
        xmlHttpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xmlHttpRequest.onreadystatechange = () => {
            if (xmlHttpRequest.readyState === 4 &&
                xmlHttpRequest.status === 200 ||
                xmlHttpRequest.status === 304) {
                hook(xmlHttpRequest.responseText)
            }
        };
        xmlHttpRequest.send(formatData);
    }
}
```

# ğŸ« å…³äº XMLHttpRequest
å…¶å® `ajax` æ— éå°±æ˜¯å¼‚æ­¥ç½‘ç»œè¯·æ±‚è€Œå·²ï¼Œå„ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ `http` åº“ï¼Œåªè¦ä½¿ç”¨ `http` åº“åŸºæœ¬ä¸Šéƒ½èƒ½è‡ªå·±å®ç° `ajax` çš„åŠŸèƒ½ï¼Œåœ¨ `js` ä¸­çš„åŸç”Ÿ `http` åº“åˆ™æ˜¯ `XMLHttpRequest`ï¼Œä½¿ç”¨ `XMLHttpRequest` å‘é€ä¸€ä¸ªè¯·æ±‚æœ‰å‡ ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥æ˜¯æ‰“å¼€è¿æ¥ã€‚

```javascript
let xmlHttpRequest = new XMLHttpRequest();
// ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¯·æ±‚ç±»å‹ï¼ŒURLå’Œæ˜¯å¦å¼‚æ­¥
xmlHttpRequest.open(TYPE, URL, ASYNC);
```

å¦‚æœæ˜¯ `POST` è¯·æ±‚æˆ–æ˜¯ä¸€äº›è‡ªå®šä¹‰çš„è¯·æ±‚ï¼Œåˆ™è¿˜éœ€è¦æ·»åŠ å¤´éƒ¨å†…å®¹

```javascript
// ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯è¯·æ±‚å¤´é”®å€¼
xmlHttpRequest.setRequestHeader(HEADER_KEY, HEADER_VALUE);
```

å¦‚æœæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œåˆ™éœ€è¦è®¾å®šå®Œæˆç›¸åº”ä¹‹åçš„å›è°ƒ

```javascript
// è¿™ä¸ªæ˜¯æŒ‡readystateå˜åŒ–çš„æ—¶å€™è§¦å‘çš„äº‹ä»¶ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸï¼Œä¼šè¿”å›200æˆ–è€…304ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œé¢è°ƒç”¨å›è°ƒï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®å‡ºé”™çš„æ—¶å€™è°ƒç”¨çš„å›è°ƒå‡½æ•°
xmlHttpRequest.onreadystatechange = () => {
  if (xmlHttpRequest.readyState === 4 &&
      xmlHttpRequest.status === 200 ||
      xmlHttpRequest.status === 304) {
      hook(xmlHttpRequest.responseText)
  }
};
```

ç„¶ååˆ™å¯ä»¥å‘é€è¯·æ±‚

```javascript
// å¦‚æœæ˜¯getï¼Œåˆ™æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼å¸¦åœ¨urlä¸­å‘é€ï¼Œå¦‚æœæ˜¯postï¼Œå‘é€çš„dataåº”è¯¥å†™åœ¨è¿™é‡Œ
xmlHttpRequest.send(DATA);
```

è¯·æ±‚å®Œæˆåæ‚”è‡ªåŠ¨è°ƒç”¨ä¹‹å‰è®¾å®šçš„é’©å­å‡½æ•°
